# ImageProcessor

**ImageProcessor** — очередь фоновой обработки изображений.  
Сервис позволяет загружать изображения, автоматически обрабатывать их в фоне (resize, водяной знак, миниатюра) и получать результат через веб-интерфейс или API.  

---

## Особенности

- Загрузка изображений через HTTP POST `/upload`
- Получение обработанного изображения через HTTP GET `/image/{id}`
- Удаление изображения через HTTP DELETE `/image/{id}`
- Фоновая обработка изображений через очередь Kafka
- Resize изображений до 800px по ширине
- Добавление водяного знака
- Генерация миниатюры (если нужно)
- Поддержка форматов: JPG, PNG, GIF (GIF конвертируется в статический)
- Простой веб-интерфейс на HTML + JS для загрузки и просмотра изображений

---

## Структура проекта

```
imageProcessor/
├── cmd/server/main.go       # точка входа приложения
├── frontend/                # веб-интерфейс (HTML, CSS, JS)
├── internal/
│   ├── app/                 # инициализация приложения
│   ├── broker/              # Kafka брокер
│   ├── config/              # загрузка конфигурации
│   ├── handlers/            # HTTP-обработчики
│   ├── service/             # сервис обработки изображений
│   └── storage/             # файловое хранилище
├── config.yaml              # конфигурация приложения
├── Dockerfile
└── docker-compose.yml
```

---

## Конфигурация

Пример `config.yaml`:

```yaml
server:
  host: "0.0.0.0"
  port: 8080

kafka:
  brokers:
    - "kafka:9092"
  topic: "image_tasks"
  group_id: "image_processor_group"

storage:
  original_path: "internal/storage/original"
  processed_path: "internal/storage/processed"

processor:
  resize_width: 800
  thumbnail_width: 200
  watermark_text: "WM"
```

- `server` — настройки HTTP сервера
- `kafka` — адрес брокеров, топик и group_id
- `storage` — пути хранения оригиналов и обработанных изображений
- `processor` — настройки обработки изображений

---

## Запуск через Docker

1. Собрать и поднять контейнеры:

```bash
docker-compose up --build
```

2. Контейнеры будут доступны:

- Приложение: [http://localhost:8080](http://localhost:8080)  
- Kafka UI: [http://localhost:8081](http://localhost:8081)

3. Для остановки и очистки томов:

```bash
docker-compose down -v
```

---

## Веб-интерфейс

- Кнопка **"Загрузить изображение"** — загрузка изображения на сервер
- Кнопка **"Удалить"** — удаление изображения
- Картинка **"В обработке..."** — отображается пока изображение не обработано
- После обработки картинка обновляется и отображается с водяным знаком

---

## API

| Метод | URL               | Описание                        |
|-------|-----------------|---------------------------------|
| POST  | /upload          | Загрузка изображения            |
| GET   | /image/{id}      | Получение обработанного изображения |
| DELETE| /image/{id}      | Удаление изображения            |

Пример запроса с `curl`:

```bash
curl -F "file=@myphoto.jpg" http://localhost:8080/upload
curl http://localhost:8080/image/<id> --output processed.jpg
curl -X DELETE http://localhost:8080/image/<id>
```

---

## Замечания

- GIF конвертируется в статическое изображение (первый кадр)
- Все изображения хранятся в контейнере, но можно смонтировать volume для физического хранения
- Фоновая обработка выполняется через Kafka, поэтому сервер не блокируется при загрузке

---

## Тестирование

1. Загрузить изображение через веб-интерфейс или API
2. Проверить, что файл появляется в `internal/storage/original`
3. После обработки проверяем `internal/storage/processed`
4. Проверяем отображение водяного знака на изображении
5. Удаление через кнопку или API работает корректно

---


