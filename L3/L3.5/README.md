# EventBooker

EventBooker — это сервис бронирования мест на мероприятия с автоматической отменой неоплаченных броней через заданный интервал времени (TTL).

Проект моделирует реальную систему регистрации на события, где важно освобождать места, если пользователь не подтвердил бронь вовремя.

Сервис включает:
- REST API
- фоновый обработчик истечения бронирований
- веб-интерфейс для пользователей и администратора
- работу с PostgreSQL
- Docker окружение
- уведомления через Telegram

---

# Основные возможности

### Работа с мероприятиями
- создание мероприятий
- просмотр списка событий
- информация о свободных местах
- настройка TTL бронирования для каждого события

### Бронирование
- пользователь может забронировать место
- бронь имеет статус `pending`
- пользователь может подтвердить бронь (оплатить)
- статус меняется на `confirmed`

### Автоматическая отмена бронирований
Если бронь не подтверждена в течение TTL:
- бронь автоматически отменяется
- статус меняется на `canceled`
- место освобождается
- пользователь получает уведомление (Telegram)

### Поддержка нескольких пользователей
Система поддерживает:
- регистрацию пользователей
- роли (user / admin)
- уникальные бронирования на событие

### Web интерфейс
Есть две страницы:

Администратор:
- создание событий
- просмотр событий

Пользователь:
- просмотр событий
- бронирование
- подтверждение брони
- отслеживание статуса

---

# Архитектура проекта

Проект построен по принципам **Clean Architecture**:


handlers → services → repositories → database


Слои:

- handlers — HTTP обработчики
- services — бизнес логика
- repositories — работа с базой
- scheduler — фоновые процессы
- notification — интеграции (Telegram)

---

# Структура проекта


.
│
├── cmd/server
│ └── main.go
│
├── internal
│ ├── booking
│ ├── event
│ ├── user
│ ├── handlers
│ ├── scheduler
│ ├── notification
│ ├── storage
│ └── config
│
├── frontend
│ ├── admin.html
│ ├── user.html
│ ├── login.html
│ └── static
│
├── migrations
│
├── docker-compose.yml
├── Dockerfile
├── config.yaml
└── .env


---

# Как работает TTL бронирования

Каждое событие имеет параметр:


booking_ttl


Он задает время жизни брони.

Когда пользователь бронирует место:

1. создается запись в таблице `bookings`
2. статус устанавливается `pending`
3. устанавливается `expires_at`

Если пользователь не подтверждает бронь:

фоновый scheduler:
- проверяет просроченные брони
- отменяет их
- возвращает место в событие

Scheduler запускается каждые:


10 секунд

---

# База данных

Используется PostgreSQL.

Основные таблицы:

### users

id
email
name
telegram_id
role
created_at


### events

id
name
date
total_seats
available_seats
booking_ttl
created_at


### bookings

id
event_id
user_id
status
created_at
expires_at


Статусы брони:


pending
confirmed
canceled

---

# Индексы

Для производительности используются индексы:

- поиск просроченных броней
- поиск броней по событию
- поиск броней пользователя
- защита от дублирующих броней
---

# API

## Создание события

POST /events


{
"name": "Go Conference",
"date": "2026-03-01T18:00",
"total_seats": 50,
"booking_ttl_minutes": 10
}

---

## Получить список событий

GET /events

---

## Получить событие

GET /events/{id}

---

## Забронировать место

POST /events/{id}/book


{
"email": "user@mail.com
",
"name": "User",
"telegram_id": "123456",
"role": "user"
}

---

## Подтвердить бронь

POST /bookings/{id}/confirm

---

## Получить брони пользователя

GET /users/{id}/bookings

---

# Web интерфейс

Главная страница:
/

Страница пользователя:
/user

Страница администратора:
/admin
---

# Запуск проекта через Docker

docker compose up --build
После запуска:
http://localhost:8080


---

# Что происходит при запуске

Docker запускает:

1) PostgreSQL  
2) миграции базы данных  
3) приложение

---

# Конфигурация

Основной конфиг:
config.yaml

Пример:
server:
host: 0.0.0.0
port: 8080

scheduler:
interval: 10s


---

# Переменные окружения

Файл:


.env


Используется для PostgreSQL и Telegram.

---

# Уведомления

Система поддерживает уведомления через Telegram:

- подтверждение брони
- отмена брони

Если токен не указан — уведомления просто не отправляются.

---

# Безопасность данных

В проекте используются:

- транзакции
- ограничения базы данных
- индексы
- уникальные ключи

Это предотвращает:

- гонки данных
- овербукинг
- дублирование бронирований

---

# Технологии

Go  
PostgreSQL  
Docker  
Gin (ginext)  
JavaScript  
HTML / CSS

---

